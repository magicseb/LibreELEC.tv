# SPDX-License-Identifier: GPL-2.0
# Copyright (C) 2017-present Team LibreELEC (https://libreelec.tv)

mkdir -p $RELEASE_DIR/3rdparty/bootloader
INSTBOOT_DIR=$RELEASE_DIR/3rdparty/bootloader/u-boot
mkdir -p $INSTBOOT_DIR
  if [ -n "$UBOOT_SYSTEM" ]; then
    BOOTLOADER_DIR=$(get_build_dir $BOOTLOADER)
    if [ -f $BOOTLOADER_DIR/idbloader.img ]; then
      cp -a $BOOTLOADER_DIR/idbloader.img $INSTBOOT_DIR
    fi
    if [ -f $BOOTLOADER_DIR/uboot.img ]; then
      cp -a $BOOTLOADER_DIR/uboot.img $INSTBOOT_DIR
    fi
    if [ -f $BOOTLOADER_DIR/trust.img ]; then
      cp -a $BOOTLOADER_DIR/trust.img $INSTBOOT_DIR
    fi
  fi

  LINUX_DTS_DIR=$(get_build_dir linux)/arch/$TARGET_KERNEL_ARCH/boot/dts
  mkdir -p $RELEASE_DIR/3rdparty/bootloader/dtb/rockchip
  for dtb in $LINUX_DTS_DIR/rockchip/*.dtb; do
    if [ -f $dtb ]; then
      cp -a $dtb $RELEASE_DIR/3rdparty/bootloader/dtb/rockchip
    fi
  done

  for file_sh in $INSTALL/instboot/*.sh; do
    if [ -f $file_sh ]; then
      cp -a $file_sh $RELEASE_DIR/3rdparty/bootloader
    fi
  done

